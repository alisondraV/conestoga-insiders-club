@page "/friends"
@using ConestogaInsidersClub.Data.Models;
@using ConestogaInsidersClub.Data.DataAccess;

@inject IUserService userService;

<h1>Friends</h1>
<br />

@if (user == null)
{
    <h3>Loading...</h3>
}
else
{
    <div>
        <button @onclick="() => SwitchToFriendsTab(true)">Your Friends</button>
        <button @onclick="() => SwitchToFriendsTab(false)">Add a Friend</button>
    </div>

    @if (friendsTab)
    {
        if (friends.Count == 0)
        {
            <h4>You have no friends yet. Go to the "Add a Friend" tab to discover new friends!</h4>
        }
        @foreach (var friend in friends)
        {
            <div>
                <p>@friend.UserName</p>
            </div>
        }
    }
    else
    {
        @foreach (var user in users)
        {
            <div>
                <p>@user.UserName</p>
            </div>
        }
    }
}

@code {
    [CascadingParameter]
    private Task<AuthenticationState> AuthenticationState { get; set; }
    private AuthenticationState authenticationState;
    private ApplicationUser user;
    private List<ApplicationUser> users;
    private List<ApplicationUser> friends;
    private bool friendsTab = true;

    protected override async Task OnInitializedAsync()
    {
        authenticationState = await AuthenticationState;
        user = await userService.GetUser(authenticationState.User.Identity.Name);
        users = await userService.GetUsers();
        friends = await userService.GetFriends(user);
    }

    private void SwitchToFriendsTab(bool isFriendsTab)
    {
        friendsTab = isFriendsTab;
    }
}
